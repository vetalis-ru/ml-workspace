Тип: Официальный модуль MemberLux
Зависимости: MemberLux Core версии >= 2.9.9, лицензионный ключ fullpackaccess или uaccess.
Назначение: Предоставление универсального ("пин-код") доступа к системе, интегрируемого с формами регистрации (в т.ч. WooCommerce), для автоматической выдачи указанного уровня доступа новым пользователям.

1. ОСНОВНЫЕ СИСТЕМНЫЕ ОПЦИИ (wpm_main_options)
Модуль добавляет глобальные настройки в систему MemberLux:

PIN-код: Уникальный код, вводимый пользователем в поле формы.

Редиректы: URL для перенаправления после успешной/неуспешной привязки доступа.

Тексты: Сообщения об ошибках, подсказки в формах.

Shortcodes: Шорткоды для вставки поля ввода PIN-кода в формы.

2. WORDPRESS HOOKS (INTEGRATION POINTS)
Модуль активно встраивается в процессы регистрации, перехватывая и модифицируя данные через фильтры.

Фильтры (Filters), которые модуль использует для интеграции:

php
// 1. ФИЛЬТРАЦИЯ ДАННЫХ ФОРМЫ РЕГИСТРАЦИИ MEMBERLUX
// Позволяет модулю "подставить" код доступа из PIN-поля в процесс регистрации.
add_filter('wpm_ajax_register_user_form_filter', 'mbl_uaccess_filter_registration_data', 10, 2);

// 2. ПЕРЕХВАТ РЕГИСТРАЦИИ WOOCOMMERCE
// Интегрируется с формами WooCommerce, чтобы добавить логику проверки PIN-кода.
add_filter('woocommerce_process_registration_errors', 'mbl_uaccess_wc_registration_check', 10, 1);
add_action('user_register', 'mbl_uaccess_attach_access_after_wc_registration', 10, 1);

// 3. ПОДМЕНА ШАБЛОНОВ WOOCOMMERCE
// Для отображения кастомного поля PIN-кода на страницах WooCommerce.
add_filter('wc_get_template', 'mbl_uaccess_override_wc_template', 10, 5);
Генерация доступа (внутренняя логика обработчиков):

php
// ПСЕВДОКОД ЛОГИКИ (например, в обработчике 'user_register')
1.  Проверить, передан ли в запросе валидный PIN-код.
2.  Найти по PIN-коду целевой `term_id` и параметры доступа (`duration`, `units`).
3.  Сгенерировать ключ: `wpm_insert_one_user_key($term_id, $duration, $units);`
4.  Немедленно активировать его для нового пользователя:
    wpm_update_user_key_dates($user_id, $generated_code, false, 'universal_access');
    // Это вызовет стандартный хук 'wpm_update_user_key_dates'.
3. ПРИНЦИП РАБОТЫ
Администратор настраивает PIN-код и привязывает его к определенному уровню доступа (term_id) через админку MemberLux.

На сайте (в форме регистрации MemberLux или WooCommerce) добавляется поле для ввода PIN-кода (через шорткод или модификацию шаблона).

Пользователь вводит PIN при регистрации.

Модуль перехватывает процесс, проверяет PIN и, если он верный, после создания пользователя автоматически генерирует и активирует для него соответствующий ключ доступа.

Срабатывают все стандартные хуки MemberLux (wpm_update_user_key_dates), что позволяет другим модулям (Сертификаты, Bridge) реагировать на это событие.

Важно: Модуль не создает собственных хуков для расширения, но является ярким примером потребителя и модификатора стандартного потока данных MemberLux через фильтры WordPress.